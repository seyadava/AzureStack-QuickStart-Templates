{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
	"contentVersion": "1.0.0.0",
	"apiProfile": "2018-03-01-hybrid",
	"parameters": {
		"authenticationSettings": {
			"type": "object"
		},
		"vlVmssSettings": {
			"type": "object"
		},
		"ubuntuImage": {
			"type": "object"
		},
		"location": {
			"type": "string"
		},
		"suffix": {
			"type": "string"
		},
		"vnetName": {
			"type": "string"
		},
		"mustDeployVnetGateway": {
			"type": "bool"
		},
		"scriptReq": {
			"type": "object"
		},
		"extensionSettings": {
			"type": "object"
		},
		"keyVaultUrl": {
			"type": "string"
		},
		"storageAccountName": {
			"type": "string"
		},
		"storagePrimaryKey": {
			"type": "string"
		},
		"ethRpcPort": {
			"type": "int"
		},
		"transactionPermissioningContract": {
			"type": "string"
		},
		"dockerRepository": {
			"type": "string"
		},
		"dockerLogin": {
			"type": "string"
		},
		"dockerPassword": {
			"type": "string"
		},
		"dockerImagePoaOrchestrator": {
			"type": "string"
		},
		"dockerImageEtheradmin": {
			"type": "string"
		},
		"dockerImageEthstat": {
			"type": "string"
		},
		"dockerImageValidator": {
			"type": "string"
		},
		"rgName": {
			"type": "string"
		},
		"keyVaultName": {
			"type": "string"
		},
		"isAdfs": {
			"type": "bool"
		},
		"certKeyVaultId": {
			"type": "string"
		},
		"certSecretUrl": {
			"type": "string"
		},
		"consortiumDataUrl": {
			"type": "string"
		}
	},
	"variables": {
		"linuxConfiguration": {
			"disablePasswordAuthentication": true,
			"ssh": {
				"publicKeys": [
					{
						"path": "[concat('/home/',variables('adminUsername'),'/.ssh/authorized_keys')]",
						"keyData": "[variables('sshPublicKey')]"
					}
				]
			}
		},
		"vlOsProfileAad": {
			"computerNamePrefix": "[variables('vlVmssName')]",
			"adminUsername": "[variables('adminUsername')]",
			"adminPassword": "[variables('adminPassword')]",
			"customData": "[base64(concat('#cloud-config\n\nwrite_files:\n- path: \"/opt/azure/containers/script.sh\"\n  permissions: \"0744\"\n  encoding: gzip\n  owner: \"root\"\n  content: !!binary |\n    H4sIAAAAAAAA/5yOwUrDUBBF9/mKoQhdJfMFLmrMQhBBa3dCGSejefDy5jEzqeLXi3VhydL9Oede4UlhezdXtYCYBEw1oN9BKHioSbdtfBkVuAKeyDCnV/wgepcS2ItFektMId5VmQEXN8zKlNEnMkGmli8gpC+/kDq2+K0vdaSQdoU3jXyejz0Nj4dh/7w/9rvjzeHh9n64RglG94w/gq+H/souI7QJWoHNyxX9K7SBMyPllEzLLCW+AwAA//8nbcUONgEAAA==\n\nruncmd:\n  - /opt/azure/containers/script.sh'))]",
			"linuxConfiguration": "[if(equals(variables('authenticationType'), 'sshPublicKey'), variables('linuxConfiguration'), json('null'))]"
		},
		"vlOsProfileAdfs": {
			"computerNamePrefix": "[variables('vlVmssName')]",
			"adminUsername": "[variables('adminUsername')]",
			"adminPassword": "[variables('adminPassword')]",
			"secrets": [
				{
					"sourceVault": {
						"id": "[parameters('certKeyVaultId')]"
					},
					"vaultCertificates": [
						{
							"certificateUrl": "[parameters('certSecretUrl')]"
						}
					]
				}
			],
			"customData": "[base64(concat('#cloud-config\n\nwrite_files:\n- path: \"/opt/azure/containers/script.sh\"\n  permissions: \"0744\"\n  encoding: gzip\n  owner: \"root\"\n  content: !!binary |\n    H4sIAAAAAAAA/5yOwUrDUBBF9/mKoQhdJfMFLmrMQhBBa3dCGSejefDy5jEzqeLXi3VhydL9Oede4UlhezdXtYCYBEw1oN9BKHioSbdtfBkVuAKeyDCnV/wgepcS2ItFektMId5VmQEXN8zKlNEnMkGmli8gpC+/kDq2+K0vdaSQdoU3jXyejz0Nj4dh/7w/9rvjzeHh9n64RglG94w/gq+H/souI7QJWoHNyxX9K7SBMyPllEzLLCW+AwAA//8nbcUONgEAAA==\n\nruncmd:\n  - /opt/azure/containers/script.sh'))]",
			"linuxConfiguration": "[if(equals(variables('authenticationType'), 'sshPublicKey'), variables('linuxConfiguration'), json('null'))]"
		},
		"isADFS": "[if(parameters('isAdfs'), 'adfs', '')]",
		"vlOsProfile": "[if(parameters('isAdfs'), variables('vlOsProfileAdfs'), variables('vlOsProfileAad'))]",
		"authenticationType": "[parameters('authenticationSettings').authenticationType]",
		"sshPublicKey": "[parameters('authenticationSettings').sshPublicKey]",
		"adminUsername": "[parameters('authenticationSettings').adminUsername]",
		"adminPassword": "[parameters('authenticationSettings').adminPassword]",
		"vlVmssName": "[concat(parameters('vlVmssSettings').vmssName, '-',parameters('suffix'))]",
		"vlNodeVMSize": "[parameters('vlVmssSettings').nodeVMSize]",
		"vlCapacity": "[parameters('vlVmssSettings').vlCapacity]",
		"vlStorageAccountType": "[parameters('vlVmssSettings').storageAccountType]",
		"vlNicName": "[parameters('vlVmssSettings').nicName]",
		"vlIpConfigName": "[parameters('vlVmssSettings').ipConfigName]",
		"vnetName": "[parameters('vnetName')]",
		"vlSubnetName": "[parameters('vlVmssSettings').subnetName]",
		"loadBalancerName": "[concat(parameters('vlVmssSettings').loadBalancerName,'-',parameters('suffix'))]",
		"lbBackendAddressPoolName": "[parameters('vlVmssSettings').loadBalancerBackendAddressPoolName]",
		"lbInboundNatRuleNamePrefix": "[parameters('vlVmssSettings').loadBalancerInboundNatRuleNamePrefix]",
		"publicIpConfiguration": [
			{
				"name": "[variables('vlIpConfigName')]",
				"properties": {
					"subnet": {
						"id": "[concat(resourceId('Microsoft.Network/virtualNetworks',variables('vnetName')),'/subnets/',variables('vlSubnetName'))]"
					},
					"loadBalancerBackendAddressPools": [
						{
							"id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/backendAddressPools/',variables('lbBackendAddressPoolName'))]"
						}
					],
					"loadBalancerInboundNatPools": [
						{
							"id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/inboundNatPools/',variables('lbInboundNatRuleNamePrefix'))]"
						}
					]
				}
			}
		],
		"gatewayIpConfiguration":[
			{
				"name": "[variables('vlIpConfigName')]",
				"properties": {
					"subnet": {
						"id": "[concat(resourceId('Microsoft.Network/virtualNetworks',variables('vnetName')),'/subnets/',variables('vlSubnetName'))]"
					},
					"loadBalancerBackendAddressPools": [
						{
							"id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/backendAddressPools/',variables('lbBackendAddressPoolName'))]"
						}
					],
					"loadBalancerInboundNatPools": [
						{
							"id": "[concat(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName')), '/inboundNatPools/',variables('lbInboundNatRuleNamePrefix'))]"
						}
					]
				}
			}
		],
		"mode": "[parameters('scriptReq').mode]",
		"artifactsLocationURL": "[parameters('extensionSettings').artifactsLocationURL]",
		"ethereumNetworkID": "[parameters('extensionSettings').ethereumNetworkID]",
		"numBootNodes": "[parameters('extensionSettings').numBootNodes]",
		"numVLNodes": "[parameters('extensionSettings').numVLNodes]",
		"adminSitePort": "[parameters('extensionSettings').adminSitePort]",
		"consortiumMemberId": "[parameters('extensionSettings').consortiumId]",
		"adminId": "[parameters('authenticationSettings').adminId]",
		"accessType": "[parameters('authenticationSettings').accessType]",
		"servicePrincipalId": "[parameters('authenticationSettings').servicePrincipalId]",
		"servicePrincipalSecret": "[parameters('authenticationSettings').servicePrincipalSecret]",
		"endpointFqdn": "[parameters('authenticationSettings').endpointFqdn]",
		"tenantId": "[parameters('authenticationSettings').tenantId]",
		"consortium-data": "[parameters('consortiumDataUrl')]",
		"omsWorkspaceId": "",
		"omsPrimaryKey": ""
	},
	"resources": [
		{
			"type": "Microsoft.Compute/virtualMachineScaleSets",
			"name": "[variables('vlVmssName')]",
			"location": "[parameters('location')]",
			"sku": {
				"name": "[variables('vlNodeVMSize')]",
				"tier": "Standard",
				"capacity": "[variables('vlCapacity')]"
			},
			"properties": {
				"singlePlacementGroup": true,
				"overprovision": false,
				"upgradePolicy": {
					"mode": "Automatic"
				},
				"virtualMachineProfile": {
					"storageProfile": {
						"osDisk": {
							"createOption": "FromImage",
							"caching": "ReadWrite",
							"managedDisk": {
								"storageAccountType": "[variables('vlStorageAccountType')]"
							}
						},
						"imageReference": "[parameters('ubuntuImage')]"
					},
					"osProfile": "[variables('vlOsProfile')]",
					"networkProfile": {
						"networkInterfaceConfigurations": [
							{
								"name": "[variables('vlNicName')]",
								"properties": {
									"primary": true,
									"ipConfigurations": "[if(parameters('mustDeployVnetGateway'), variables('gatewayIpConfiguration'), variables('publicIpConfiguration'))]"
								}
							}
						]
					},
					"extensionProfile": {
						"extensions": [
							{
								"name": "[concat(variables('vlVmssName'),'-config')]",
								"properties": {
									"publisher": "Microsoft.Azure.Extensions",
									"type": "CustomScript",
									"settings": {
										"fileUris" : [
											"[parameters('scriptReq').fileUri]"
										]
									},
									"typeHandlerVersion": "2.0",
									"autoUpgradeMinorVersion": true,
									"protectedSettings": {
										"commandToExecute": "[concat('base64 -d <<< ','IyEvYmluL2Jhc2gKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFN0YXJ0cyBjb25maWd1cmF0aW9uIG9mIFBPQS4gSW5zdGFsbHMgcmVxdWlyZWQgcGFja2FnZXMgYW5kIGRlcGVuZGVuY2llcyAsIGRvd25sb2FkIHNjcmlwdHMgYW5kIGNvbmZpZ3VyYXRpb24gZmlsZXMKIyBhbmQgc3RhcnRzIFBPQSBvcmNoZXN0cmF0aW9uIHByb2Nlc3MKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgojIFV0aWxpdHkgZnVuY3Rpb24gdG8gZXhpdCB3aXRoIG1lc3NhZ2UKdW5zdWNjZXNzZnVsX2V4aXQoKQp7CiAgZWNobyAiRkFUQUw6IEV4aXRpbmcgc2NyaXB0IGR1ZSB0bzogJDEsIGVycm9yIGNvZGU6ICQyIiB8IHRlZSAtYSAkQ09ORklHX0xPR19GSUxFX1BBVEg7CiAgZXhpdCAkMjsKfQoKc2V0dXBfZGVwZW5kZW5jaWVzKCkKewoJIyBBbGxvdyB0aW1lIGZvciB0aGUgbmV0d29yayBpbnRlcmZhY2VzIHRvIHN0YWJpbGl6ZQoJc2xlZXAgNjA7CgoJIyMjIyMjIyMjIyMjIyMjIwoJIyBVcGRhdGUgbW9kdWxlcwoJIyMjIyMjIyMjIyMjIyMjIwoJY29tbWFuZF93aXRoX3JldHJ5ICJzdWRvIGFwdC1nZXQgLXkgdXBkYXRlIiAidXBkYXRlIEFQVCBwYWNrYWdlIGhhbmRsaW5nIHV0aWxpdHkuIjsKCSMgVG8gYXZvaWQgaW50ZXJtaXR0ZW50IGlzc3VlcyB3aXRoIHBhY2thZ2UgREIgc3RheWluZyBsb2NrZWQgd2hlbiBuZXh0IGFwdC1nZXQgcnVucwoJc2xlZXAgMTA7CgoJIyMjIyMjIyMjIyMjIyMjIyMjCgkjIEluc3RhbGwgcGFja2FnZXMKCSMjIyMjIyMjIyMjIyMjIyMjIwoJY29tbWFuZF93aXRoX3JldHJ5ICJzdWRvIGFwdC1nZXQgLXkgaW5zdGFsbCBqcSBzb2Z0d2FyZS1wcm9wZXJ0aWVzLWNvbW1vbiAteSAtLWFsbG93LWRvd25ncmFkZXMiICJpbnN0YWxsIGdpdCBvciBqcS4iOwoKCSMgSW5zdGFsbCBhenVyZSBDTEkKCUFaX1JFUE89JChsc2JfcmVsZWFzZSAtY3MpCgllY2hvICJkZWIgW2FyY2g9YW1kNjRdIGh0dHBzOi8vcGFja2FnZXMubWljcm9zb2Z0LmNvbS9yZXBvcy9henVyZS1jbGkvICRBWl9SRVBPIG1haW4iIHwgXAoJc3VkbyB0ZWUgL2V0Yy9hcHQvc291cmNlcy5saXN0LmQvYXp1cmUtY2xpLmxpc3QKCgljb21tYW5kX3dpdGhfcmV0cnkgInN1ZG8gYXB0LWtleSBhZHYgLS1rZXlzZXJ2ZXIgcGFja2FnZXMubWljcm9zb2Z0LmNvbSAtLXJlY3Yta2V5cyA1MkUxNkY4NkZFRTA0Qjk3OUIwN0UyOERCMDJDNDZERjQxN0EwODkzIiAiSW1wb3J0IHBhY2thZ2VzLm1pY3Jvc29mdC5jb20gc2VydmVyIGtleXMgZmFpbGVkLiI7CgljdXJsIC1MIGh0dHBzOi8vcGFja2FnZXMubWljcm9zb2Z0LmNvbS9rZXlzL21pY3Jvc29mdC5hc2MgfCBzdWRvIGFwdC1rZXkgYWRkIC0gfHwgdW5zdWNjZXNzZnVsX2V4aXQgIkZhaWxlZCB0byBpbnN0YWxsIGEgbmV3IGtleSBmcm9tIHBhY2thZ2VzLm1pY3Jvc29mdC5jb20gc2VydmVyIiA0Cgljb21tYW5kX3dpdGhfcmV0cnkgInN1ZG8gYXB0LWdldCBpbnN0YWxsIGFwdC10cmFuc3BvcnQtaHR0cHMiICJGYWlsZWQgdG8gaW5zdGFsbCBhcHQtdHJhbnNwb3J0LWh0dHBzLiI7Cgljb21tYW5kX3dpdGhfcmV0cnkgInN1ZG8gYXB0LWdldCB1cGRhdGUgJiYgc3VkbyBhcHQtZ2V0IGluc3RhbGwgYXp1cmUtY2xpIiAiRmFpbGVkIHRvIGluc3RhbGwgYXp1cmUtY2xpLiI7CgoJIyBDb25maWd1cmUgYXp1cmUtY2xpIHRvIG5vdCBsb2cgdGVsZW1ldHJ5IGR1ZSB0byBpc3N1ZXMgd2l0aCB0ZWxlbWV0cnkgdXBsb2FkIHByb2Nlc3NlcyBub3QgZmluaXNoaW5nCgkjIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL2NsaS9henVyZS9henVyZS1jbGktY29uZmlndXJhdGlvbj92aWV3PWF6dXJlLWNsaS1sYXRlc3QjY2xpLWNvbmZpZ3VyYXRpb24tdmFsdWVzLWFuZC1lbnZpcm9ubWVudC12YXJpYWJsZXMKCXN1ZG8gc2VkIC1pIC1lICJcJGFBWlVSRV9DT1JFX0NPTExFQ1RfVEVMRU1FVFJZPVwiZmFsc2VcIiIgL2V0Yy9lbnZpcm9ubWVudAp9CgppbnN0YWxsX2RvY2tlcigpIHsKCgllY2hvICI9PT09PT09PT09PT09PSBJbnN0YWxsaW5nIGRvY2tlciBlbmdpbmUgLi4uIgoJc3VkbyBhcHQtZ2V0IHJlbW92ZSBkb2NrZXIgZG9ja2VyLWVuZ2luZSBkb2NrZXIuaW8KCglzdWRvIGFwdC1nZXQgaW5zdGFsbCBcCglhcHQtdHJhbnNwb3J0LWh0dHBzIFwKCWNhLWNlcnRpZmljYXRlcyBcCgljdXJsIFwKCXNvZnR3YXJlLXByb3BlcnRpZXMtY29tbW9uCgoJY3VybCAtZnNTTCBodHRwczovL2Rvd25sb2FkLmRvY2tlci5jb20vbGludXgvdWJ1bnR1L2dwZyB8IHN1ZG8gYXB0LWtleSBhZGQgLQoJc3VkbyBhZGQtYXB0LXJlcG9zaXRvcnkgImRlYiBbYXJjaD1hbWQ2NF0gaHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL2xpbnV4L3VidW50dSAkKGxzYl9yZWxlYXNlIC1jcykgc3RhYmxlIgoJc3VkbyBhcHQtZ2V0IHVwZGF0ZQoJYXB0LWNhY2hlIHBvbGljeSBkb2NrZXItY2UKCXN1ZG8gYXB0LWdldCBpbnN0YWxsIC15IGRvY2tlci1jZQoJCgllY2hvICI9PT09PT09PT09PSBGaW5pc2hlZCBpbnN0YWxsaW5nIGRvY2tlciBlbmdpbmUuIgp9CgojIFJldHJ5IENvbW1hbmRgCiMgJDEgOiBDb21tYW5kIHdoaWNoIHJ1biBmb3IgIAojICQyIDogRXJyb3IgTWVzc2FnZSB3aGVuIHRoZSBjb21tYW5kKCQxKSBmYWlsZWQgZm9yICROT09GVFJJRVMgdGltZXMKY29tbWFuZF93aXRoX3JldHJ5KCkKewoJc3VjY2Vzcz0wCglmb3IgTE9PUENPVU5UIGluIGBzZXEgMSAkTk9PRlRSSUVTYDsgZG8KCQlldmFsICQxCgkJRVhJVF9DT0RFPSQ/CgkJaWYgWyAkRVhJVF9DT0RFIC1uZSAwIF07IHRoZW4KCQkJZWNobyAiRmFpbGVkIHRvICQyICRMT09QQ09VTlQgdGltZXMgd2l0aCBleGl0IGNvZGUgJEVYSVRfQ09ERSwgcmV0cnlpbmcuLi4iID4+ICRDT05GSUdfTE9HX0ZJTEVfUEFUSDsKCQkJIyBleHBvbmVudGlhbCBiYWNrLW9mZgoJCQlzbGVlcCAkKCg1KiokTE9PUENPVU5UKSk7CgkJCWNvbnRpbnVlOwoJCWVsc2UKCQkJc3VjY2Vzcz0xCgkJCWJyZWFrOwoJCWZpCglkb25lCglpZiBbICRzdWNjZXNzIC1uZSAxIF07IHRoZW4KCQl1bnN1Y2Nlc3NmdWxfZXhpdCAiRmFpbGVkIHRvICQyIGFmdGVyICROT09GVFJJRVMgbnVtYmVyIG9mIGF0dGVtcHRzLiIgNQoJZmkKfQoKIyBBY3F1aXJlcyBsZWFzZSBvbiBjb250YWluZXIKYWNxdWlyZV9sZWFzZV9vbl9jb250YWluZXIoKQp7Cgljb250YWluZXJOYW1lPSQxCiAgICBzdG9yYWdlQWNjb3VudE5hbWU9JDIKICAgIGFjY291bnRLZXk9JDMKCiAgICBheiBzdG9yYWdlIGNvbnRhaW5lciBjcmVhdGUgLS1uYW1lICRjb250YWluZXJOYW1lIC0tYWNjb3VudC1uYW1lICRzdG9yYWdlQWNjb3VudE5hbWUgLS1hY2NvdW50LWtleSAkYWNjb3VudEtleSAtLWZhaWwtb24tZXhpc3Q7CiAgICBpZiBbICQ/IC1uZSAwIF07IHRoZW4KICAgICAgICBlY2hvICJBdHRlbXB0IHRvIGNyZWF0ZSB0aGUgbGVhc2UgY29udGFpbmVyIG9uIHN0b3JhZ2UgYWNjb3VudCBoYXMgZmFpbGVkLiIgPj4gJENPTkZJR19MT0dfRklMRV9QQVRIOwogICAgZWxzZQoJCSMgVE9ETzogYWNxdWlyZSBsZWFzZSBvcGVyYXRpb24gY291bGQgZmFpbC4gTWFrZSBtdWx0aXBsZSBhdHRlbXBzIGhlcmUKCQlpZD0kKGF6IHN0b3JhZ2UgY29udGFpbmVyIGxlYXNlIGFjcXVpcmUgLWMgJGNvbnRhaW5lck5hbWUgLS1sZWFzZS1kdXJhdGlvbiAtMSAtLWFjY291bnQtbmFtZSAkc3RvcmFnZUFjY291bnROYW1lIC0tYWNjb3VudC1rZXkgJGFjY291bnRLZXkgLS1vdXRwdXQgdHN2KTsKCQlpZiBbICQ/IC1lcSAwIF07IHRoZW4KCQkJZWNobyAiQWNxdWlyZWQgbGVhc2Ugb24gY29udGFpbmVyLiIgPj4gJENPTkZJR19MT0dfRklMRV9QQVRIOwoJCQllY2hvICJMZWFzZSBJRDokaWQiID4+ICRDT05GSUdfTE9HX0ZJTEVfUEFUSDsKCQkJTEVBU0VfSUQ9JGlkOwoJCWZpCglmaQp9CgojIFVzZSBNU0kgdG8gZ2V0IGFjY2VzcyB0b2tlbiBmb3IgYXV0aGVudGljYXRpbmcgdG8gYXp1cmUga2V5IHZhdWx0IApnZXRfYWNjZXNzX3Rva2VuKCkKewogICAgYXV0aF9yZXNwb25zZT0kKGN1cmwgaHR0cDovL2xvY2FsaG9zdDo1MDM0Mi9vYXV0aDIvdG9rZW4gLUggJ01ldGFkYXRhOnRydWUnIC0tZGF0YSAicmVzb3VyY2U9aHR0cHM6Ly92YXVsdC5henVyZS5uZXQiKTsKICAgIGlmIFsgJD8gLW5lIDAgXTsgdGhlbiB1bnN1Y2Nlc3NmdWxfZXhpdCAiRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB3aXRoIGF6dXJlIGtleSB2YXVsdC4iIDY7IGZpCiAgICBhY2Nlc3NUb2tlbj0kKGVjaG8gJGF1dGhfcmVzcG9uc2UgfCBqcSAtciAiLmFjY2Vzc190b2tlbiIpCiAgICBlY2hvICRhY2Nlc3NUb2tlbjsKfQoKIyBVc2UgU1BOIHRvIGdldCBhY2Nlc3MgdG9rZW4gZm9yIGF1dGhlbnRpY2F0aW9uIHRvIGF6dXJlIGtleXZhdWx0IHdoZW4gTVNJIGlzIG5vdCBhdmFpbGFibGUKZ2V0X2FjY2Vzc190b2tlbl9zcG4oKQp7CiAgICAjIFJlcXVpcmVkIGlucHV0CiAgICBmcWRuPSQxCiAgICBhcHBpZD0kMgogICAga2V5PSQzCiAgICB0ZW5hbnRpZD0kNAoKICAgICMgR2V0IGF1ZGllbmNlCiAgICBhdWRpZW5jZT0kKGN1cmwgLXMgImh0dHBzOi8vbWFuYWdlbWVudC4kZnFkbi9tZXRhZGF0YS9lbmRwb2ludHM/YXBpLXZlcnNpb249MjAxNS0wMS0wMSIgfCBqcSAtciAiLmF1dGhlbnRpY2F0aW9uLmF1ZGllbmNlc1swXSIpCgogICAgIyBEZWZpbmUga2V5dmF1bHQgZW5kcG9pbnQgKHJlcGxhY2UgbWFuYWdlbWVudCB3aXRoIHZhdWx0IGluIHRoZSB1cmwpCiAgICByZXNvdXJjZT0iJHthdWRpZW5jZS9tYW5hZ2VtZW50L3ZhdWx0fSIgCgogICAgIyBHZXQgVG9rZW4gZm9yIEF6dXJlIFN0YWNrIEtleSBWYXVsdAogICAgYXV0aF9yZXNwb25zZT0kKGN1cmwgLXMgLS1oZWFkZXIgImFjY2VwdDogYXBwbGljYXRpb24vanNvbiIgLS1yZXF1ZXN0IFBPU1QgImh0dHBzOi8vbG9naW4ud2luZG93cy5uZXQvJHRlbmFudGlkL29hdXRoMi90b2tlbiIgLS1kYXRhLXVybGVuY29kZSAicmVzb3VyY2U9JHJlc291cmNlIiAtLWRhdGEtdXJsZW5jb2RlICJjbGllbnRfaWQ9JGFwcGlkIiAtLWRhdGEtdXJsZW5jb2RlICJncmFudF90eXBlPWNsaWVudF9jcmVkZW50aWFscyIgLS1kYXRhLXVybGVuY29kZSAiY2xpZW50X3NlY3JldD0ka2V5Iik7CgogICAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuIHVuc3VjY2Vzc2Z1bF9leGl0ICJGYWlsZWQgdG8gYXV0aGVudGljYXRlIHdpdGggYXp1cmUga2V5IHZhdWx0LiIgNTE7IGZpCiAgICBhY2Nlc3NUb2tlbj0kKGVjaG8gJGF1dGhfcmVzcG9uc2UgfCBqcSAtciAiLmFjY2Vzc190b2tlbiIpCgogICAgZWNobyAkYWNjZXNzVG9rZW47Cn0KCmRvd25sb2FkX2RvY2tlcl9pbWFnZXMoKSB7CgllY2hvICI9PT09PT09PT09PSBQdWxsaW5nIGRvY2tlciBpbWFnZSBmcm9tIGF6dXJlIGNvbnRhaW5lciByZWdpc3RyeS4iCgljb21tYW5kX3dpdGhfcmV0cnkgInN1ZG8gZG9ja2VyIGxvZ2luICRET0NLRVJfUkVQT1NJVE9SWSAgLXUgJERPQ0tFUl9MT0dJTiAtcCAkRE9DS0VSX1BBU1NXT1JEIiAiVW5hYmxlIHRvIGxvZ2luIHRvIGF6dXJlIGNvbnRhaW5lciByZWdpc3RyeS4iOwoJY29tbWFuZF93aXRoX3JldHJ5ICJzdWRvIGRvY2tlciBwdWxsICRPUkNIRVNUUkFUT1JfRE9DS0VSX0lNQUdFIiAiRmFpbGVkIHRvIGRvd25sb2FkIGRvY2tlciBpbWFnZSAkT1JDSEVTVFJBVE9SX0RPQ0tFUl9JTUFHRS4iOwoJZWNobyAiPT09PT09PT09PT09IEZpbmlzaGVkIHB1bGxpbmcgZG9ja2VyIGltYWdlIGZyb20gYXp1cmUgY29udGFpbmVyIHJlZ2lzdHJ5LiIKfQoKIyBBdHRlbXB0cyB0byBydW4gb3JjaGVzdHJhdGlvbiBsb2dpYwpvcmNoZXN0cmF0ZV9wb2EoKQp7CglOdW1BdHRlbXB0PSQxCglpc1N1Y2Nlc3NmdWw9IiIKCglmb3IgTE9PUENPVU5UIGluIGBzZXEgMSAkTnVtQXR0ZW1wdGA7IGRvCQoJCSMgaWYgWyAiJEFDQ0VTU19UWVBFIiA9ICJTUE4iIF07IHRoZW4KCQkjIAlBQ0NFU1NfVE9LRU49JChnZXRfYWNjZXNzX3Rva2VuX3NwbiAiJEVORFBPSU5UU19GUUROIiAiJFNQTl9BUFBJRCIgIiRTUE5fS0VZIiAiJEFBRF9URU5BTlRJRCIpOwoJCSMgZWxzZQoJCSMgCUFDQ0VTU19UT0tFTj0kKGdldF9hY2Nlc3NfdG9rZW4pOwoJCSMgZmkKCQlBQ0NFU1NfVE9LRU49IiIKCQljb250YWluZXJJZD0kKHN1ZG8gZG9ja2VyIHJ1biAtZCAtdiAkREVQTE9ZTUVOVF9MT0dfUEFUSDokREVQTE9ZTUVOVF9MT0dfUEFUSCAtdiAkUEFSSVRZX0RFVl9QQVRIOiRQQVJJVFlfREVWX1BBVEggLXYgJENFUlRJRklDQVRFX1BBVEg6JENFUlRJRklDQVRFX1BBVEggLWUgTk9ERV9FTlY9cHJvZHVjdGlvbiAtZSBOb2RlQ291bnQ9JE5vZGVDb3VudCAtZSBNT0RFPSRNT0RFIC1lIEtFWV9WQVVMVF9CQVNFX1VSTD0kS0VZX1ZBVUxUX0JBU0VfVVJMIC1lIFNUT1JBR0VfQUNDT1VOVD0kU1RPUkFHRV9BQ0NPVU5UIC1lIENPTlRBSU5FUl9OQU1FPSRDT05UQUlORVJfTkFNRSAtZSBTVE9SQUdFX0FDQ09VTlRfS0VZPSRTVE9SQUdFX0FDQ09VTlRfS0VZIC1lIEVUSF9ORVRXT1JLX0lEPSRFVEhfTkVUV09SS19JRCAtZSBWQUxJREFUT1JfQURNSU5fQUNDT1VOVD0kVkFMSURBVE9SX0FETUlOX0FDQ09VTlQgLWUgQ09OU09SVElVTV9EQVRBX1VSTD0kQ09OU09SVElVTV9EQVRBX1VSTCAtZSBBQ0NFU1NfVE9LRU49JEFDQ0VTU19UT0tFTiAtZSBDT05GSUdfTE9HX0ZJTEVfUEFUSD0kQ09ORklHX0xPR19GSUxFX1BBVEggLWUgVFJBTlNBQ1RJT05fUEVSTUlTU0lPTl9DT05UUkFDVD0iJFRSQU5TQUNUSU9OX1BFUk1JU1NJT05fQ09OVFJBQ1QiIC1lIEFBRF9URU5BTlRJRD0kQUFEX1RFTkFOVElEIC1lIFNQTl9LRVk9JFNQTl9LRVkgLWUgU1BOX0FQUElEPSRTUE5fQVBQSUQgLWUgUkdfTkFNRT0kUkdfTkFNRSAtZSBLVl9OQU1FPSRLVl9OQU1FIC1lIEVORFBPSU5UU19GUUROPSRFTkRQT0lOVFNfRlFETiAtZSBJU19BREZTPSRJU19BREZTIC0tbmV0d29yayBob3N0ICRPUkNIRVNUUkFUT1JfRE9DS0VSX0lNQUdFKTsKCQlpZiBbICQ/IC1uZSAwIF07IHRoZW4KCQkJdW5zdWNjZXNzZnVsX2V4aXQgIlVuYWJsZSB0byBydW4gZG9ja2VyIGltYWdlICRPUkNIRVNUUkFUT1JfRE9DS0VSX0lNQUdFLiIgODsKCQkJYnJlYWs7CgkJZmkKICAgICAgICAKCQlzdWRvIGRvY2tlciB3YWl0ICRjb250YWluZXJJZAoJCWV4aXRDb2RlPSQoc3VkbyBkb2NrZXIgaW5zcGVjdCAkY29udGFpbmVySWQgLS1mb3JtYXQ9J3t7LlN0YXRlLkV4aXRDb2RlfX0nKTsKCQlpZiBbICRleGl0Q29kZSAtbmUgMCBdOyB0aGVuCgkJCWVjaG8gIkV4ZWN1dGluZyBkb2NrZXIgaW1hZ2UgJE9SQ0hFU1RSQVRPUl9ET0NLRVJfSU1BR0UgZmFpbGVkIG9uIHRyeSAkTE9PUENPVU5UIHdpdGggZXhpdCBjb2RlICRleGl0Q29kZS4iID4+ICRDT05GSUdfTE9HX0ZJTEVfUEFUSDsKCQkJc2xlZXAgMjsKCQkJY29udGludWU7CgkJZWxzZQoJCQllY2hvICI9PT09PT09PSBQT0Egb3JjaGVzdHJhdGlvbiBzdWNjZXNzZnVsISA9PT09PT09PSAiID4+ICRDT05GSUdfTE9HX0ZJTEVfUEFUSDsKCQkJaXNTdWNjZXNzZnVsPSJTVUNDRVNTIjsKCQkJYnJlYWs7CgkJZmkKCWRvbmUKCglpZiBbIC16ICRpc1N1Y2Nlc3NmdWwgXTsgdGhlbgoJCXVuc3VjY2Vzc2Z1bF9leGl0ICJVbmFibGUgdG8gb3JjaGVzdHJhdGUgcG9hLiIgOwoJZmkKfQoKIyBTZXR1cCByYy5sb2NhbCBmb3Igc2VydmljZSBzdGFydCBvbiBib290CnNldHVwX3JjX2xvY2FsKCkKewoJZWNobyAiPT09PT0gU3RhcnRlZCBzZXR1cF9yY19sb2NhbCA9PT09PSI7CiAgICBlY2hvIC1lICcjIS9iaW4vYmFzaCcgIlxuc3VkbyAtdSAkQVpVUkVVU0VSIC9iaW4vYmFzaCAkSE9NRURJUi9jb25maWd1cmUtdmFsaWRhdG9yLnNoIFwiJEFaVVJFVVNFUlwiIFwiJE5vZGVDb3VudFwiIFwiJEtFWV9WQVVMVF9CQVNFX1VSTFwiIFwiJFNUT1JBR0VfQUNDT1VOVFwiIFwiJENPTlRBSU5FUl9OQU1FXCIgXCIkU1RPUkFHRV9BQ0NPVU5UX0tFWVwiIFwiJFZBTElEQVRPUl9BRE1JTl9BQ0NPVU5UXCIgXCIkTlVNX0JPT1RfTk9ERVNcIiBcIiRSUENfUE9SVFwiIFwiJE9NU19XT1JLU1BBQ0VfSURcIiBcIiRPTVNfUFJJTUFSWV9LRVlcIiBcIiRBRE1JTl9TSVRFX1BPUlRcIiBcIiRDT05TT1JUSVVNX01FTUJFUl9JRFwiIFwiJE1PREVcIiBcIiRDT05TT1JUSVVNX0RBVEFfVVJMXCIgXCIkRE9DS0VSX1JFUE9TSVRPUllcIiBcIiRET0NLRVJfTE9HSU5cIiBcIiRET0NLRVJfUEFTU1dPUkRcIiBcIiRET0NLRVJfSU1BR0VfRVRIRVJBRE1JTlwiIFwiJERPQ0tFUl9JTUFHRV9FVEhTVEFUXCIgXCIkRE9DS0VSX0lNQUdFX1ZBTElEQVRPUlwiIFwiJE1VU1RfREVQTE9ZX0dBVEVXQVlcIiBcIiRBQ0NFU1NfVFlQRVwiIFwiJEVORFBPSU5UU19GUUROXCIgXCIkU1BOX0FQUElEXCIgXCIkU1BOX0tFWVwiIFwiJEFBRF9URU5BTlRJRFwiIFwiJFJHX05BTUVcIiBcIiRJU19BREZTXCIgPj4gJENPTkZJR19MT0dfRklMRV9QQVRIIDI+JjEgJiAiIHwgc3VkbyB0ZWUgL2V0Yy9yYy5sb2NhbCAyPiYxIDE+L2Rldi9udWxsCQoJaWYgWyAkPyAtbmUgMCBdOyB0aGVuCgkJdW5zdWNjZXNzZnVsX2V4aXQgIkZhaWxlZCB0byBzZXR1cCByYy5sb2NhbCBmb3IgcmVzdGFydCBvbiBWTSByZWJvb3QuIiAzOwoJZmkKCWVjaG8gIj09PT09IENvbXBsZXRlZCBzZXR1cF9yY19sb2NhbCA9PT09PSI7Cn0KCndnZXRfd2l0aF9yZXRyeSgpCnsKCXN1Y2Nlc3M9MAoJZm9yIExPT1BDT1VOVCBpbiBgc2VxIDEgJE5PT0ZUUklFU2A7IGRvCgkJc3VkbyAtdSAkQVpVUkVVU0VSIC9iaW4vYmFzaCAtYyAid2dldCAtTiAkMSAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIjsKCQlFWElUX0NPREU9JD8KCQlpZiBbICRFWElUX0NPREUgLW5lIDAgXTsgdGhlbgoJCQllY2hvICJGYWlsZWQgdG8gd2dldCAkMSAkTE9PUENPVU5UIHRpbWVzIHdpdGggZXhpdCBjb2RlICRFWElUX0NPREUsIHJldHJ5aW5nLi4uIiA+PiAkQ09ORklHX0xPR19GSUxFX1BBVEg7CgkJCSMgZXhwb25lbnRpYWwgYmFjay1vZmYKCQkJc2xlZXAgJCgoNSoqJExPT1BDT1VOVCkpOwoJCQljb250aW51ZTsKCQllbHNlCgkJCXN1Y2Nlc3M9MQoJCQlicmVhazsKCQlmaQoJZG9uZQoJaWYgWyAkc3VjY2VzcyAtbmUgMSBdOyB0aGVuCgkJdW5zdWNjZXNzZnVsX2V4aXQgIkZhaWxlZCB0byBkb3dubG9hZCAkMSBhZnRlciAkTk9PRlRSSUVTIG51bWJlciBvZiBhdHRlbXB0cy4iIDgKCWZpCn0KCmlzX3BvYV9uZXR3b3JrX3VwKCkgewogICAgaWYgWyAkKHdjIC1sIDwgJFBPQV9ORVRXT1JLX1VQRklMRSkgLWx0IDEgXTsgdGhlbiBlY2hvIDA7IGVsc2UgZWNobyAxOyBmaQp9CgpzZXR1cF9jbGlfY2VydGlmaWNhdGVzKCkKewoJaWYgWyAiJEFDQ0VTU19UWVBFIiA9ICJTUE4iIF07IHRoZW4KCQlzdWRvIGNwIC92YXIvbGliL3dhYWdlbnQvQ2VydGlmaWNhdGVzLnBlbSAvdXNyL2xvY2FsL3NoYXJlL2NhLWNlcnRpZmljYXRlcy9henNDZXJ0aWZpY2F0ZS5jcnQKCQlzdWRvIHVwZGF0ZS1jYS1jZXJ0aWZpY2F0ZXMKCQlleHBvcnQgUkVRVUVTVFNfQ0FfQlVORExFPS9ldGMvc3NsL2NlcnRzL2NhLWNlcnRpZmljYXRlcy5jcnQKCQlzdWRvIHNlZCAtaSAtZSAiXCRhUkVRVUVTVFNfQ0FfQlVORExFPS9ldGMvc3NsL2NlcnRzL2NhLWNlcnRpZmljYXRlcy5jcnQiIC9ldGMvZW52aXJvbm1lbnQKCWZpCgoJaWYgW1sgISAteiAiJElTX0FERlMiIF1dOyB0aGVuCgkJI2lmIFtbICRTUE5fS0VZICE9ICoic2VydmljZVByaW5jaXBhbENlcnRpZmljYXRlLnBlbSIqIF1dOyB0aGVuCgkJc3BDZXJ0TmFtZT0iJFNQTl9LRVkuY3J0IgoJCXNwQ2VydEtleT0iJFNQTl9LRVkucHJ2IgoJCXN1ZG8gY3AgL3Zhci9saWIvd2FhZ2VudC8kc3BDZXJ0TmFtZSAvaG9tZS8KCQlzdWRvIGNwIC92YXIvbGliL3dhYWdlbnQvJHNwQ2VydEtleSAvaG9tZS8KCQlzdWRvIGNhdCAvaG9tZS8kc3BDZXJ0TmFtZSAvaG9tZS8kc3BDZXJ0S2V5ID4gL2hvbWUvc2VydmljZVByaW5jaXBhbENlcnRpZmljYXRlLnBlbQoJCXN1ZG8gY2htb2QgNjQ0IC9ob21lL3NlcnZpY2VQcmluY2lwYWxDZXJ0aWZpY2F0ZS5wZW0KCQkjU1BOX0tFWT0vaG9tZS9zZXJ2aWNlUHJpbmNpcGFsQ2VydGlmaWNhdGUucGVtCgkJYXogY2xvdWQgcmVnaXN0ZXIgLW4gQXp1cmVTdGFja0Nsb3VkIC0tZW5kcG9pbnQtcmVzb3VyY2UtbWFuYWdlciAiaHR0cHM6Ly9tYW5hZ2VtZW50LiRFTkRQT0lOVFNfRlFETiIgLS1zdWZmaXgtc3RvcmFnZS1lbmRwb2ludCAiJEVORFBPSU5UU19GUUROIiAtLXN1ZmZpeC1rZXl2YXVsdC1kbnMgIi52YXVsdC4kRU5EUE9JTlRTX0ZRRE4iCgkJYXogY2xvdWQgc2V0IC1uIEF6dXJlU3RhY2tDbG91ZAoJCWF6IGNsb3VkIHVwZGF0ZSAtLXByb2ZpbGUgMjAxOC0wMy0wMS1oeWJyaWQKCQlheiBsb2dpbiAtLXNlcnZpY2UtcHJpbmNpcGFsIC11ICRTUE5fQVBQSUQgLXAgL2hvbWUvc2VydmljZVByaW5jaXBhbENlcnRpZmljYXRlLnBlbSAtLXRlbmFudCAkQUFEX1RFTkFOVElECgkJI2ZpCgllbHNlCgkJYXogY2xvdWQgcmVnaXN0ZXIgLW4gQXp1cmVTdGFja0Nsb3VkIC0tZW5kcG9pbnQtcmVzb3VyY2UtbWFuYWdlciAiaHR0cHM6Ly9tYW5hZ2VtZW50LiRFTkRQT0lOVFNfRlFETiIgLS1zdWZmaXgtc3RvcmFnZS1lbmRwb2ludCAiJEVORFBPSU5UU19GUUROIiAtLXN1ZmZpeC1rZXl2YXVsdC1kbnMgIi52YXVsdC4kRU5EUE9JTlRTX0ZRRE4iCgkJYXogY2xvdWQgc2V0IC1uIEF6dXJlU3RhY2tDbG91ZAoJCWF6IGNsb3VkIHVwZGF0ZSAtLXByb2ZpbGUgMjAxOC0wMy0wMS1oeWJyaWQKCQlheiBsb2dpbiAtLXNlcnZpY2UtcHJpbmNpcGFsIC11ICRTUE5fQVBQSUQgLXAgJFNQTl9LRVkgLS10ZW5hbnQgJEFBRF9URU5BTlRJRAoJZmkKfQoKY29uZmlndXJlX2VuZHBvaW50cygpCnsKICAgIGF6IGNsb3VkIHJlZ2lzdGVyIC1uIEF6dXJlU3RhY2tDbG91ZCAtLWVuZHBvaW50LXJlc291cmNlLW1hbmFnZXIgImh0dHBzOi8vbWFuYWdlbWVudC4kRU5EUE9JTlRTX0ZRRE4iIC0tc3VmZml4LXN0b3JhZ2UtZW5kcG9pbnQgIiRFTkRQT0lOVFNfRlFETiIgLS1zdWZmaXgta2V5dmF1bHQtZG5zICIudmF1bHQuJEVORFBPSU5UU19GUUROIgogICAgYXogY2xvdWQgc2V0IC1uIEF6dXJlU3RhY2tDbG91ZAogICAgYXogY2xvdWQgdXBkYXRlIC0tcHJvZmlsZSAyMDE4LTAzLTAxLWh5YnJpZAoJYXogbG9naW4gLS1zZXJ2aWNlLXByaW5jaXBhbCAtdSAkU1BOX0FQUElEIC1wICRTUE5fS0VZIC0tdGVuYW50ICRBQURfVEVOQU5USUQKfQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgUGFyYW1ldGVycyA6IFZhbGlkYXRlIHRoYXQgYWxsIGFyZ3VtZW50cyBhcmUgc3VwcGxpZWQKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmlmIFsgJCMgLWx0IDMxIF07IHRoZW4gdW5zdWNjZXNzZnVsX2V4aXQgIkluc3VmZmljaWVudCBwYXJhbWV0ZXJzIHN1cHBsaWVkLiIgMTsgZmkKCkFaVVJFVVNFUj0kMQpBUlRJRkFDVFNfVVJMX1BSRUZJWD0kMgpOVU1fQk9PVF9OT0RFUz0kMwpOb2RlQ291bnQ9JDQKTU9ERT0kNQpPTVNfV09SS1NQQUNFX0lEPSQ2Ck9NU19QUklNQVJZX0tFWT0kNwpLRVlfVkFVTFRfQkFTRV9VUkw9JDgKU1RPUkFHRV9BQ0NPVU5UPSQ5ClNUT1JBR0VfQUNDT1VOVF9LRVk9JHsxMH0KUlBDX1BPUlQ9JHsxMX0KQURNSU5fU0lURV9QT1JUPSR7MTJ9CkNPTlNPUlRJVU1fTUVNQkVSX0lEPSR7MTN9CkVUSF9ORVRXT1JLX0lEPSR7MTR9ClZBTElEQVRPUl9BRE1JTl9BQ0NPVU5UPSR7MTV9ClRSQU5TQUNUSU9OX1BFUk1JU1NJT05fQ09OVFJBQ1Q9JHsxNn0KQ09OU09SVElVTV9EQVRBX1VSTD0kezE3fQpET0NLRVJfUkVQT1NJVE9SWT0kezE4fQpET0NLRVJfTE9HSU49JHsxOX0KRE9DS0VSX1BBU1NXT1JEPSR7MjB9CkRPQ0tFUl9JTUFHRV9QT0FfT1JDSEVTVFJBVE9SPSR7MjF9CkRPQ0tFUl9JTUFHRV9FVEhFUkFETUlOPSR7MjJ9CkRPQ0tFUl9JTUFHRV9FVEhTVEFUPSR7MjN9CkRPQ0tFUl9JTUFHRV9WQUxJREFUT1I9JHsyNH0KTVVTVF9ERVBMT1lfR0FURVdBWT0kezI1fQoKIyBIeWJyaWQgZW52aXJvbm1lbnQgYXJndW1lbnRzCkFDQ0VTU19UWVBFPSR7MjZ9ClNQTl9BUFBJRD0kezI3fQpTUE5fS0VZPSR7Mjh9CkVORFBPSU5UU19GUUROPSR7Mjl9CkFBRF9URU5BTlRJRD0kezMwfQpSR19OQU1FPSR7MzF9CktWX05BTUU9JHszMn0KSVNfQURGUz0kezMzfQoKIyBFY2hvIG91dCB0aGUgcGFyYW1ldGVycwplY2hvICItLS0gY29uZmlndXJlLXBvYS5zaCBzdGFydGluZyB1cCAtLS0iCmVjaG8gIkFaVVJFVVNFUiA9ICRBWlVSRVVTRVIiCmVjaG8gIkFSVElGQUNUU19VUkxfUFJFRklYID0gJEFSVElGQUNUU19VUkxfUFJFRklYIgplY2hvICJOVU1fQk9PVF9OT0RFUyA9ICROVU1fQk9PVF9OT0RFUyIKZWNobyAiTm9kZUNvdW50ID0gJE5vZGVDb3VudCIKZWNobyAiTU9ERT0kTU9ERSIKZWNobyAiT01TX1dPUktTUEFDRV9JRD0kT01TX1dPUktTUEFDRV9JRCIKZWNobyAiT01TX1BSSU1BUllfS0VZPSRPTVNfUFJJTUFSWV9LRVkiCmVjaG8gIktFWV9WQVVMVF9CQVNFX1VSTCA9ICRLRVlfVkFVTFRfQkFTRV9VUkwiCmVjaG8gIlNUT1JBR0VfQUNDT1VOVCA9ICRTVE9SQUdFX0FDQ09VTlQiCmVjaG8gIlNUT1JBR0VfQUNDT1VOVF9LRVkgPSAkU1RPUkFHRV9BQ0NPVU5UX0tFWSIKZWNobyAiUlBDX1BPUlQgPSAkUlBDX1BPUlQiCmVjaG8gIkFETUlOX1NJVEVfUE9SVCA9ICRBRE1JTl9TSVRFX1BPUlQiCmVjaG8gIkNPTlNPUlRJVU1fTUVNQkVSX0lEID0gJENPTlNPUlRJVU1fTUVNQkVSX0lEIgplY2hvICJFVEhfTkVUV09SS19JRCA9ICRFVEhfTkVUV09SS19JRCIKZWNobyAiVkFMSURBVE9SX0FETUlOX0FDQ09VTlQgPSAkVkFMSURBVE9SX0FETUlOX0FDQ09VTlQiCmVjaG8gIlRSQU5TQUNUSU9OX1BFUk1JU1NJT05fQ09OVFJBQ1QgPSAkVFJBTlNBQ1RJT05fUEVSTUlTU0lPTl9DT05UUkFDVCIKZWNobyAiQ09OU09SVElVTV9EQVRBX1VSTD0kQ09OU09SVElVTV9EQVRBX1VSTCIKZWNobyAiRE9DS0VSX1JFUE9TSVRPUlk9JERPQ0tFUl9SRVBPU0lUT1JZIgplY2hvICJET0NLRVJfTE9HSU49JERPQ0tFUl9MT0dJTiIKZWNobyAiRE9DS0VSX1BBU1NXT1JEPSRET0NLRVJfUEFTU1dPUkQiCmVjaG8gIkRPQ0tFUl9JTUFHRV9QT0FfT1JDSEVTVFJBVE9SID0gJERPQ0tFUl9JTUFHRV9QT0FfT1JDSEVTVFJBVE9SIgplY2hvICJET0NLRVJfSU1BR0VfRVRIRVJBRE1JTj0kRE9DS0VSX0lNQUdFX0VUSEVSQURNSU4iCmVjaG8gIkRPQ0tFUl9JTUFHRV9FVEhTVEFUPSRET0NLRVJfSU1BR0VfRVRIU1RBVCIKZWNobyAiRE9DS0VSX0lNQUdFX1ZBTElEQVRPUiA9ICRET0NLRVJfSU1BR0VfVkFMSURBVE9SIgplY2hvICJNVVNUX0RFUExPWV9HQVRFV0FZPSRNVVNUX0RFUExPWV9HQVRFV0FZIgplY2hvICJBQ0NFU1NfVFlQRT0kQUNDRVNTX1RZUEUiCmVjaG8gIlNQTl9BUFBJRD0kU1BOX0FQUElEIgplY2hvICJTUE5fS0VZPSRTUE5fS0VZIgplY2hvICJFTkRQT0lOVFNfRlFETj0kRU5EUE9JTlRTX0ZRRE4iCmVjaG8gIkFBRF9URU5BTlRJRD0kQUFEX1RFTkFOVElEIgplY2hvICJSR19OQU1FID0gJFJHX05BTUUiCmVjaG8gIktWX05BTUUgPSAkS1ZfTkFNRSIKZWNobyAiSVNfQURGUyA9ICRJU19BREZTIgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIExvZyBGb2xkZXIgTG9jYXRpb25zCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKREVQTE9ZTUVOVF9MT0dfUEFUSD0iL3Zhci9sb2cvZGVwbG95bWVudCIKQ0VSVElGSUNBVEVfUEFUSD0iL3Zhci9saWIvd2FhZ2VudCIKUEFSSVRZX0xPR19QQVRIPSIvdmFyL2xvZy9wYXJpdHkiClBBUklUWV9SVU5fUEFUSD0iL29wdC9wYXJpdHkiCkFETUlOU0lURV9MT0dfUEFUSD0iL3Zhci9sb2cvYWRtaW5zaXRlIgpTVEFUU19MT0dfUEFUSD0iL3Zhci9sb2cvc3RhdHMiCkNPTkZJR19MT0dfRklMRV9QQVRIPSIkREVQTE9ZTUVOVF9MT0dfUEFUSC9jb25maWcubG9nIjsKUEFSSVRZX0RFVl9QQVRIPSIvdG1wL3Bhcml0eSIKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBDcmVhdGUgbG9nZ2luZyBkaXJlY3RvcmllcwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCnN1ZG8gbWtkaXIgJFBBUklUWV9MT0dfUEFUSApzdWRvIGNob3duIDphZG0gJFBBUklUWV9MT0dfUEFUSApzdWRvIGNobW9kIC1SIGcrdyAkUEFSSVRZX0xPR19QQVRICgpzdWRvIG1rZGlyICRQQVJJVFlfUlVOX1BBVEgKc3VkbyBjaG93biA6YWRtICRQQVJJVFlfUlVOX1BBVEgKc3VkbyBjaG1vZCAtUiBnK3cgJFBBUklUWV9SVU5fUEFUSAoKc3VkbyBta2RpciAkUEFSSVRZX0RFVl9QQVRICnN1ZG8gY2hvd24gOmFkbSAkUEFSSVRZX0RFVl9QQVRICnN1ZG8gY2htb2QgLVIgZyt3ICRQQVJJVFlfREVWX1BBVEgKCnN1ZG8gbWtkaXIgJERFUExPWU1FTlRfTE9HX1BBVEgKc3VkbyBjaG93biA6YWRtICRERVBMT1lNRU5UX0xPR19QQVRICnN1ZG8gY2htb2QgLVIgZyt3ICRERVBMT1lNRU5UX0xPR19QQVRICgpzdWRvIG1rZGlyICRBRE1JTlNJVEVfTE9HX1BBVEgKc3VkbyBjaG93biA6YWRtICRBRE1JTlNJVEVfTE9HX1BBVEgKc3VkbyBjaG1vZCAtUiBnK3cgJEFETUlOU0lURV9MT0dfUEFUSAoKc3VkbyBta2RpciAkU1RBVFNfTE9HX1BBVEgKc3VkbyBjaG93biA6YWRtICRTVEFUU19MT0dfUEFUSApzdWRvIGNobW9kIC1SIGcrdyAkU1RBVFNfTE9HX1BBVEgKCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgQ29uc3RhbnRzCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKQ09OVEFJTkVSX05BTUU9InBvYS1jb25maWciCkhPTUVESVI9Ii9ob21lLyRBWlVSRVVTRVIiOwpMRUFTRV9JRD0iIjsKTk9PRlRSSUVTPTUKRVRIRVJBRE1JTl9IT01FPSIkSE9NRURJUi9ldGhlcmFkbWluIjsKT1JDSEVTVFJBVE9SX0RPQ0tFUl9JTUFHRT0iJERPQ0tFUl9SRVBPU0lUT1JZLyRET0NLRVJfSU1BR0VfUE9BX09SQ0hFU1RSQVRPUiIKU0xFRVBfSU5URVJWQUxfSU5fU0VDUz0yOwpQT0FfTkVUV09SS19VUEZJTEU9IiRIT01FRElSL25ldHdvcmt1cC50eHQiOwoKc3VkbyAtdSAkQVpVUkVVU0VSIHRvdWNoICRDT05GSUdfTE9HX0ZJTEVfUEFUSAoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFNhbml0eSBjaGVjayBvbiBwYXJhbWV0ZXJzCmlmIFsgIiRNT0RFIiAhPSAiTGVhZGVyIiBdICYmIFsgIiRNT0RFIiAhPSAiU2luZ2xlIiBdICYmIFsgIiRNT0RFIiAhPSAiTWVtYmVyIiBdOyB0aGVuCgl1bnN1Y2Nlc3NmdWxfZXhpdCAiSW52YWxpZCBkZXBsb3ltZW50IG1vZGUuIiAyOwpmaQoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIEdldCB0aGUgc2NyaXB0IGZvciBydW5uaW5nIGFzIEF6dXJlIHVzZXIKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpjZCAiJEhPTUVESVIiOwp3Z2V0X3dpdGhfcmV0cnkgIiR7QVJUSUZBQ1RTX1VSTF9QUkVGSVh9L3NjcmlwdHMvcG9hLXV0aWxpdHkuc2giOwp3Z2V0X3dpdGhfcmV0cnkgIiR7QVJUSUZBQ1RTX1VSTF9QUkVGSVh9L3NjcmlwdHMvY29uZmlndXJlLXZhbGlkYXRvci5zaCI7CndnZXRfd2l0aF9yZXRyeSAiJHtBUlRJRkFDVFNfVVJMX1BSRUZJWH0vc2NyaXB0cy9ydW4tdmFsaWRhdG9yLnNoIjsKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIEluc3RhbGwgcGFja2FnZXMgYW5kIGRlcGVuZGVuY2llcwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKY2QgIiRIT01FRElSIjsKc2V0dXBfZGVwZW5kZW5jaWVzCgojIEFkZCB1c2VyIHRvIGRvY2tlciBncm91cCBhbmQgaW5zdGFsbCBkb2NrZXIKc3VkbyB1c2VybW9kIC1hRyBkb2NrZXIgJHtVU0VSfQppbnN0YWxsX2RvY2tlcgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBDb3B5IHJlcXVpcmVkIGNlcnRpZmljYXRlcyBmb3IgQXp1cmUgQ0xJCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpzZXR1cF9jbGlfY2VydGlmaWNhdGVzCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBDb25maWd1cmUgQ2xvdWQgRW5kcG9pbnRzIGluIEF6dXJlIENMSQojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKI2NvbmZpZ3VyZV9lbmRwb2ludHMKc3VkbyAtdSAkQVpVUkVVU0VSIC9iaW4vYmFzaCAtYyAibWtkaXIgLXAgJEVUSEVSQURNSU5fSE9NRS9wdWJsaWMiOwpkb3dubG9hZF9kb2NrZXJfaW1hZ2VzCgojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgQWNxdWlyZSBsZWFzZSBvbiBjb250YWluZXIgYW5kIHJ1biBvcmNoZXN0cmF0b3IgbG9naWMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwphY3F1aXJlX2xlYXNlX29uX2NvbnRhaW5lciAkQ09OVEFJTkVSX05BTUUgJFNUT1JBR0VfQUNDT1VOVCAgJFNUT1JBR0VfQUNDT1VOVF9LRVk7CmlmIFsgISAteiAkTEVBU0VfSUQgXTsgdGhlbgoJb3JjaGVzdHJhdGVfcG9hICROT09GVFJJRVMKZmkKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFJ1biB2YWxpZGF0b3Igbm9kZS4KIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCnNldHVwX3JjX2xvY2FsCnN1ZG8gLXUgJEFaVVJFVVNFUiAvYmluL2Jhc2ggL2hvbWUvJEFaVVJFVVNFUi9jb25maWd1cmUtdmFsaWRhdG9yLnNoICIkQVpVUkVVU0VSIiAiJE5vZGVDb3VudCIgIiRLRVlfVkFVTFRfQkFTRV9VUkwiICIkU1RPUkFHRV9BQ0NPVU5UIiAiJENPTlRBSU5FUl9OQU1FIiAiJFNUT1JBR0VfQUNDT1VOVF9LRVkiICIkVkFMSURBVE9SX0FETUlOX0FDQ09VTlQiICIkTlVNX0JPT1RfTk9ERVMiICIkUlBDX1BPUlQiICIkT01TX1dPUktTUEFDRV9JRCIgIiRPTVNfUFJJTUFSWV9LRVkiICIkQURNSU5fU0lURV9QT1JUIiAiJENPTlNPUlRJVU1fTUVNQkVSX0lEIiAiJE1PREUiICIkQ09OU09SVElVTV9EQVRBX1VSTCIgIiRET0NLRVJfUkVQT1NJVE9SWSIgIiRET0NLRVJfTE9HSU4iICIkRE9DS0VSX1BBU1NXT1JEIiAiJERPQ0tFUl9JTUFHRV9FVEhFUkFETUlOIiAiJERPQ0tFUl9JTUFHRV9FVEhTVEFUIiAiJERPQ0tFUl9JTUFHRV9WQUxJREFUT1IiICIkTVVTVF9ERVBMT1lfR0FURVdBWSIgIiRBQ0NFU1NfVFlQRSIgIiRFTkRQT0lOVFNfRlFETiIgIiRTUE5fQVBQSUQiICIkU1BOX0tFWSIgIiRBQURfVEVOQU5USUQiICIkUkdfTkFNRSIgIiRJU19BREZTIiA+PiAkQ09ORklHX0xPR19GSUxFX1BBVEggMj4mMSAmCgojIyMjIyMjIyMjIyMjIyMgRGVwbG95bWVudCBDb21wbGV0ZWQgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwplY2hvICJDb21tYW5kcyBzdWNjZWVkZWQuIEV4aXRpbmciOwpleGl0IDA7',' | sh -s ', , parameters('scriptReq').filename, ' \"', variables('adminUsername'), '\" \"', variables('artifactsLocationURL'), '\" \"', variables('numBootNodes'), '\" \"', variables('numVLNodes'), '\" \"', variables('mode'), '\" \"', variables('omsWorkspaceId'), '\" \"', variables('omsPrimaryKey'), '\" \"', parameters('keyVaultUrl'), '\" \"', parameters('storageAccountName'), '\" \"', parameters('storagePrimaryKey'), '\" \"', parameters('ethRpcPort'), '\" \"', variables('adminSitePort'), '\" \"', variables('consortiumMemberId'), '\" \"', variables('ethereumNetworkID'),'\" \"', variables('adminId'),'\" \"', parameters('transactionPermissioningContract'),'\" \"',variables('consortium-data'),'\" \"',parameters('dockerRepository'),'\" \"',parameters('dockerLogin'),'\" \"',parameters('dockerPassword'),'\" \"',parameters('dockerImagePoaOrchestrator'),'\" \"',parameters('dockerImageEtheradmin'),'\" \"',parameters('dockerImageEthstat'),'\" \"',parameters('dockerImageValidator'), '\" \"',parameters('mustDeployVnetGateway'), '\" \"',variables('accessType'), '\" \"',variables('servicePrincipalId'), '\" \"',variables('servicePrincipalSecret'), '\" \"',variables('endpointFqdn'), '\" \"',variables('tenantId'), '\" \"',parameters('rgName'), '\" \"',parameters('keyVaultName'), '\" \"',variables('isADFS'), '\"')]"
									}
								}
							}
						]
					}
				}
			}
		}
	],
	"outputs": {
		"Result": {
			"type": "object",
			"value": {
				"name": "[variables('vlVmssName')]",
				"vmssPrincipalId": ""
			}
		}
	}
}